<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login e Logout</title>
  </head>
  <body>
    <h1>Bem-vindo!</h1>

    <div id="login-form">
      <h2>Login</h2>
      <label for="usuario">Usuário:</label>
      <input type="text" id="usuario" required />
      <br />
      <label for="senha">Senha:</label>
      <input type="password" id="senha" required />
      <br />
      <button onclick="login()">Login</button>
    </div>

    <div id="logout-form" style="display: none">
      <h2>Você está logado!</h2>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="protected-link" style="display: none">
      <h2>Acesse a página protegida</h2>
      <a href="protected.html">Ir para página protegida</a>
    </div>

    <script>
      const apiUrl = "http://localhost:8000"; // Altere para a URL da sua API

      // Verificar se o usuário está logado
      function checkLoginStatus() {
        const userId = localStorage.getItem("user_id"); // Usando localStorage em vez de sessionStorage
        if (userId) {
          document.getElementById("login-form").style.display = "none";
          document.getElementById("logout-form").style.display = "block";
          document.getElementById("protected-link").style.display = "block";
        } else {
          document.getElementById("login-form").style.display = "block";
          document.getElementById("logout-form").style.display = "none";
          document.getElementById("protected-link").style.display = "none";
        }
      }

      // Login
      async function login() {
        const usuario = document.getElementById("usuario").value;
        const senha = document.getElementById("senha").value;

        if (!usuario || !senha) {
          alert("Preencha o usuário e a senha");
          return;
        }

        const response = await fetch(`${apiUrl}/login`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ usuario, senha }),
        });

        const result = await response.json();

        if (response.ok) {
          alert(result.message);
          localStorage.setItem("user_id", result.user_id); // Guardar ID de usuário no localStorage
          checkLoginStatus();
        } else {
          alert(result.error);
        }
      }

      // Logout
      async function logout() {
        const response = await fetch(`${apiUrl}/logout`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        });

        const result = await response.json();

        if (response.ok) {
          alert(result.message);
          localStorage.removeItem("user_id"); // Remover o ID de usuário do localStorage
          checkLoginStatus();
        } else {
          alert(result.error);
        }
      }

      // Verificar o status de login quando a página carregar
      window.onload = checkLoginStatus;
    </script>
  </body>
</html>
